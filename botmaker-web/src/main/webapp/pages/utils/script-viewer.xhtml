<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:f="http://java.sun.com/jsf/core" xmlns:h="http://java.sun.com/jsf/html"
	xmlns:rich="http://richfaces.org/rich" xmlns:a4j="http://richfaces.org/a4j">
	<rich:popupPanel id="scriptViewer" styleClass="script-editor" show="false" onshow="configureViewer()" domElementAttachment="form" header="Script Viewer" height="500" width="960">
		<f:facet name="controls">
			<h:commandLink>
				<h:graphicImage value="/resources/img/close-popup.png" />
				<rich:componentControl target="scriptViewer" operation="hide" />
			</h:commandLink>
		</f:facet>
		<h:panelGrid columns="3" columnClasses="pc20 txtop,pc60 txtop,pc20 txtop" styleClass="pc100">
			<h:panelGroup layout="block" styleClass="hg100pc bck-script-editor">
				<h:panelGrid styleClass="pc100" columns="5" columnClasses="pc20 txrgt,pc20,pc20 txrgt,pc20,pc20 txctr">
					<h:outputLabel value="Script Type" />
					<h:outputText value="#{scriptAction.script.scriptType}"
						styleClass="txt #{(scriptAction.script.scriptType eq 'GROOVY') ? 'groovy' : (scriptAction.script.scriptType eq 'JAVASCRIPT' ? 'javascript' : 'python')}" />
					<h:outputLabel value="Parse Mode" />
					<h:outputText value="#{(scriptAction.script.parseMode eq 'MARKDOWN') ? 'MarkDown' : 'Html'}" styleClass="txt #{(scriptAction.script.parseMode eq 'MARKDOWN') ? 'markdown' : 'html'}" />
					<h:commandButton id="btScriptCloseId" value="Close" styleClass="primary">
						<rich:componentControl event="click" target="scriptViewer" operation="hide" />
						<f:ajax execute="@this" immediate="true" />
					</h:commandButton>
				</h:panelGrid>
				<h:panelGroup layout="block" styleClass="frm-line">
					<h:inputTextarea id="scriptCode" value="#{scriptAction.script.code}" rows="16" />
				</h:panelGroup>
			</h:panelGroup>
		</h:panelGrid>
	</rich:popupPanel>
	<script type="text/javascript">
		function configureViewer() {
			scriptCodeMirror = CodeMirror.fromTextArea(document.getElementById('frm:scriptCode'), {
				mode: "groovy",
			    theme: "#{userPreferenceAction.scriptingTheme.value}", 
			    lineNumbers: true, 
			    lineWrapping: true, 
			    indentWithTabs: true, 
			    indentUnit: 4, 
			    readOnly: true
			});
			scriptCodeMirror.setSize('98%', 400);
			scriptCodeMirror.setOption('theme', '#{userPreferenceAction.scriptingTheme.value}');
		}
	</script>
</ui:composition>