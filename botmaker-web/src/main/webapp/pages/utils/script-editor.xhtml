<?xml version="1.0" encoding="UTF-8"?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml" xmlns:ui="http://java.sun.com/jsf/facelets" xmlns:f="http://java.sun.com/jsf/core" xmlns:h="http://java.sun.com/jsf/html"
	xmlns:rich="http://richfaces.org/rich" xmlns:a4j="http://richfaces.org/a4j">

	<rich:popupPanel id="scriptEditor" modal="true" moveable="true" header="Script Editor" height="600" width="800">
		<f:facet name="controls">
			<h:commandLink>
				<h:graphicImage value="/resources/img/close-popup.png" />
				<rich:componentControl target="scriptEditor" operation="hide" />
			</h:commandLink>
		</f:facet>

		<h:panelGroup layout="block" styleClass="pc100" rendered="#{not readOnly}">
			<b>Available Environment Variables</b>
			<br />
			<ul>
				<li><i>idChat</i> : Integer value from Telegram Chat who origins the Dialog.</li>
				<li><i>dateInMilis</i> : Integer value who represents the datetime (in milliseconds) that the Dialog starts.</li>
				<li><i>userId</i> : Integer value from Telegram User.</li>
				<li><i>userAnswer</i> : String value with the user answer content.</li>
			</ul>
		</h:panelGroup>

		<rich:panel styleClass="pc100">
			<h:panelGrid columns="4" columnClasses="pc25,pc25,pc25,pc25" styleClass="pc100">
				<h:outputLabel value="Script Type" />
				<h:selectOneMenu id="scriptTypeId" value="#{scriptType}" immediate="true">
					<f:selectItems value="#{auxAction.scriptTypeOpt}" var="stOpt" itemLabel="#{stOpt.descriptor}" itemValue="#{stOpt}" />
				</h:selectOneMenu>
				<h:outputLabel value="Parse Mode" />
				<h:selectOneMenu id="parseModeId" value="#{parseMode}" immediate="true">
					<f:selectItems value="#{auxAction.parseModeOpt}" var="pmOpt" itemValue="#{pmOpt}" />
				</h:selectOneMenu>
			</h:panelGrid>
			<h:panelGroup layout="block" styleClass="frm-line">
				<h:inputTextarea id="scriptCode" value="#{scriptCode}" readonly="#{readOnly}" rows="12" immediate="true" />
			</h:panelGroup>
			<h:panelGroup layout="block" styleClass="frm-submit">
				<h:commandLink value="Close" onclick="#{rich:component('scriptEditor')}.hide()" styleClass="secondary" immediate="true">
					<f:ajax execute="scriptEditor scriptCode" event="click" />
				</h:commandLink>
				<h:commandButton id="btScriptSaveId" value="Save and Close" action="#{commandAction.saveCommandPostScript()}" onclick="#{rich:component('scriptEditor')}.hide()" styleClass="secondary" />
			</h:panelGroup>
		</rich:panel>

	</rich:popupPanel>

	<script type="text/javascript">
		var scriptCodeMirror = CodeMirror.fromTextArea(document.getElementById('frm:scriptCode'), {
			mode: "groovy",
		    theme: "#{userPreferenceAction.scriptingTheme.value}", 
		    lineNumbers: true, 
		    height: 500,
		    widht: '90%',  
		    indentWithTabs: true
		});

		function editableMode(editable) {
			if (editable) {
				document.getElementById("frm:scriptTypeId").readOnly = false;
				document.getElementById("frm:scriptTypeId").disabled = false;
				document.getElementById("frm:parseModeId").readOnly = false;
				document.getElementById("frm:parseModeId").disabled = false;
				document.getElementById("frm:btScriptSaveId").style.visibility = 'visible';
				document.getElementById("frm:btScriptSaveId").style.display = 'inline-block';
			} else {
				document.getElementById("frm:scriptTypeId").readOnly = true;
				document.getElementById("frm:scriptTypeId").disabled = true;
				document.getElementById("frm:parseModeId").readOnly = true;
				document.getElementById("frm:parseModeId").disabled = true;
				document.getElementById("frm:btScriptSaveId").style.visibility = 'hidden';
				document.getElementById("frm:btScriptSaveId").style.display = 'none';
			}
		}
	</script>

</ui:composition>